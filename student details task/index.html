<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Details Form</title>
  <style>
    /* Body & Background */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f0f4f7;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("image/bgimg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.2;
      z-index: -1;
    }

    /* Fade-in Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Heading */
    h2 {
      text-align: center;
      font-size: 2.5rem;
      color: #2e7d32;
      margin: 30px 0;
      opacity: 0;
      transform: translateY(-20px);
      animation: fadeIn 1s forwards 0.2s;
    }

    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
    }
    .status-badge.connected {
      background: #4CAF50;
      color: white;
    }
    .status-badge.disconnected {
      background: #f44336;
      color: white;
    }

    /* Form Container */
    .form-container {
      width: 90%;
      max-width: 700px;
      background: #ffffff;
      padding: 25px 40px;
      border-radius: 15px;
      box-shadow: 0 12px 25px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 15px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 1s forwards 0.4s;
    }
    .form-container label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }
    .form-container input,
    .form-container select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      transition: border 0.3s, box-shadow 0.3s;
    }
    .form-container input:focus,
    .form-container select:focus {
      border-color: #4CAF50;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
      outline: none;
    }

    /* Buttons Container */
    .btn-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
    }

    .save-btn, .reset-btn, .refresh-btn {
      width: 120px;
      background: linear-gradient(135deg, #4CAF50, #2e7d32);
      color: white;
      font-weight: 600;
      border: none;
      padding: 10px 0;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    .save-btn:hover, .reset-btn:hover, .refresh-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }
    .reset-btn {
      background: linear-gradient(135deg, #f44336, #d32f2f);
    }
    .refresh-btn {
      background: linear-gradient(135deg, #2196F3, #1976D2);
    }

    /* Table Container for Responsiveness */
    .table-container {
      width: 90%;
      max-width: 1200px;
      margin-top: 30px;
      overflow-x: auto;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 1s forwards 0.6s;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      border-radius: 12px;
    }

    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px; /* Minimum width to prevent squishing */
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 12px 10px;
      text-align: center;
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Equal column widths */
    th:nth-child(1), td:nth-child(1) { width: 15%; } /* NAME */
    th:nth-child(2), td:nth-child(2) { width: 8%; }  /* AGE */
    th:nth-child(3), td:nth-child(3) { width: 15%; } /* COURSE */
    th:nth-child(4), td:nth-child(4) { width: 8%; }  /* GENDER */
    th:nth-child(5), td:nth-child(5) { width: 18%; } /* EMAIL */
    th:nth-child(6), td:nth-child(6) { width: 12%; } /* PHONE */
    th:nth-child(7), td:nth-child(7) { width: 10%; } /* STATUS */
    th:nth-child(8), td:nth-child(8) { width: 14%; } /* ACTION */
    
    th {
      background: linear-gradient(135deg, #4CAF50, #2e7d32);
      color: white;
      letter-spacing: 0.5px;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    tbody tr {
      background: #fff;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }
    tbody tr:hover {
      transform: scale(1.01);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      background: #f1f9f1;
    }
    
    /* Responsive adjustments */
    @media screen and (max-width: 1024px) {
      .table-container {
        width: 95%;
      }
      th, td {
        padding: 10px 8px;
        font-size: 0.85rem;
      }
    }
    
    @media screen and (max-width: 768px) {
      .table-container {
        width: 98%;
        margin-top: 20px;
      }
      th, td {
        padding: 8px 5px;
        font-size: 0.8rem;
      }
      table {
        min-width: 700px;
      }
    }
    .delete-btn {
      background: #f44336;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      font-size: 0.85rem;
    }
    .delete-btn:hover {
      background: #d32f2f;
      transform: scale(1.05);
    }

    /* Search section styles */
    #studentSelect {
      cursor: pointer;
    }
    #studentSelect option {
      padding: 8px;
      cursor: pointer;
    }
    #studentSelect option:hover {
      background: #e8f5e9;
    }

    /* Footer */
    footer {
      text-align: center;
      margin: 30px 0;
      font-size: 0.95rem;
      color: #555;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 1s forwards 0.8s;
    }

    /* Gender inputs spacing */
    .gender-group {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    /* Loading spinner */
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
      color: #4CAF50;
      font-weight: 600;
    }

    /* Status badge styles */
    .status-enrolled {
      background: #4CAF50;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
      min-width: 80px;
    }
    .status-in-progress {
      background: #FF9800;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
      min-width: 80px;
    }
    .status-completed {
      background: #2196F3;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
      min-width: 80px;
    }

  </style>
</head>
<body>

  <h2>
    Student Details Form - Operational Database 
    <span class="status-badge disconnected" id="connectionStatus">Disconnected</span>
  </h2>

  <!-- Search Section -->
  <div class="form-container" style="margin-bottom: 20px;">
    <h3 style="margin: 0 0 15px 0; color: #2e7d32; text-align: center;">üîç Search & Select Student</h3>
    <div style="display: flex; gap: 10px; align-items: flex-end;">
      <div style="flex: 1;">
        <label>Search by Name</label>
        <input type="text" id="searchName" placeholder="Type student name...">
      </div>
      <button class="refresh-btn" style="width: 100px; height: 42px;" onclick="searchStudent()">Search</button>
    </div>
    
    <!-- Search Results Dropdown -->
    <div id="searchResults" style="display: none; margin-top: 10px; border: 1px solid #4CAF50; border-radius: 8px; padding: 10px; background: #f9fff9;">
      <p style="margin: 0 0 10px 0; font-weight: 600; color: #2e7d32;">Select a student:</p>
      <select id="studentSelect" size="5" style="width: 100%; padding: 5px; border: 1px solid #ccc; border-radius: 5px;">
        <!-- Options will be populated here -->
      </select>
      <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
        <button class="save-btn" style="width: 100px;" onclick="loadSelectedStudent()">Load</button>
        <button class="reset-btn" style="width: 100px;" onclick="closeSearch()">Close</button>
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div class="form-container">
    <h3 style="margin: 0 0 15px 0; color: #2e7d32; text-align: center;" id="formTitle">‚ûï Add New Student</h3>
    
    <!-- Hidden field to store student ID for updates -->
    <input type="hidden" id="studentId" value="">
    
    <div>
      <label>Name</label>
      <input type="text" id="name">
    </div>
    <div>
      <label>Age</label>
      <input type="number" id="age">
    </div>
    <div class="gender-group">
      <label>Gender</label>
      <input type="radio" name="gender" value="Male"> Male
      <input type="radio" name="gender" value="Female"> Female
    </div>
    <div>
      <label>Course</label>
      <select id="course">
        <option value="" selected disabled>Select a course</option>
        <option value="MERN Stack">MERN Stack</option>
        <option value="Python Development">Python Development</option>
        <option value="Data Science">Data Science</option>
        <option value="JavaScript">JavaScript</option>
        <option value="Java">Java</option>
      </select>
    </div>
    <div>
      <label>Email</label>
      <input type="email" id="email">
    </div>
    <div>
      <label>Phone</label>
      <input type="tel" id="phone" placeholder="123-456-7890">
    </div>
    <div>
      <label>Status</label>
      <select id="status">
        <option value="enrolled" selected>Enrolled</option>
        <option value="in-progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <div class="btn-container">
      <button class="save-btn" id="saveBtn" onclick="saveStudent()">Save</button>
      <button class="save-btn" id="updateBtn" onclick="updateStudent()" style="display: none; background: linear-gradient(135deg, #FF9800, #F57C00);">Update</button>
      <button class="reset-btn" onclick="resetForm()">Reset</button>
      <button class="refresh-btn" onclick="loadStudents()">Refresh</button>
    </div>
  </div>

  <div class="loading" id="loading">Loading...</div>

  <div class="table-container">
    <table id="studentTable">
      <thead>
        <tr>
          <th>NAME</th>
          <th>AGE</th>
          <th>COURSE</th>
          <th>GENDER</th>
          <th>EMAIL</th>
          <th>PHONE</th>
          <th>STATUS</th>
          <th>ACTION</th>
        </tr>
      </thead>
      <tbody>
        <!-- Student rows will appear here -->
      </tbody>
    </table>
  </div>

  <footer>
    &copy; 2025 Professional Student Form - Full Stack Application. All rights reserved.
  </footer>

  <script>
    // API Configuration
    const API_BASE_URL = 'https://student-management-backend-fullstack.vercel.app';
    
    // Check backend connection on page load
    window.addEventListener('DOMContentLoaded', () => {
      checkConnection();
      loadStudents();
    });

    // Check if backend is connected
    async function checkConnection() {
      try {
        const response = await fetch(`${API_BASE_URL}/health`);
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('connectionStatus').textContent = 'Connected';
          document.getElementById('connectionStatus').className = 'status-badge connected';
        }
      } catch (error) {
        console.error('Backend connection failed:', error);
        document.getElementById('connectionStatus').textContent = 'Disconnected';
        document.getElementById('connectionStatus').className = 'status-badge disconnected';
        alert('‚ö†Ô∏è Cannot connect to backend! Make sure the backend server is running on port 3000.');
      }
    }

    // Load all students from backend
    async function loadStudents() {
      const loading = document.getElementById('loading');
      loading.style.display = 'block';
      
      try {
        const response = await fetch(`${API_BASE_URL}/students`);
        const result = await response.json();
        
        if (result.success) {
          displayStudents(result.data);
        } else {
          alert('Failed to load students');
        }
      } catch (error) {
        console.error('Error loading students:', error);
        alert('‚ùå Error loading students. Make sure backend is running!');
      } finally {
        loading.style.display = 'none';
      }
    }

    // Display students in table
    function displayStudents(students) {
      const tbody = document.getElementById('studentTable').getElementsByTagName('tbody')[0];
      tbody.innerHTML = ''; // Clear existing rows
      
      // Store students globally for search
      allStudents = students;
      
      students.forEach(student => {
        const row = tbody.insertRow();
        // Format status text
        const statusText = student.status === 'in-progress' ? 'In Progress' : 
                          student.status.charAt(0).toUpperCase() + student.status.slice(1);
        
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.age}</td>
          <td>${student.course}</td>
          <td>${getGenderFromEmail(student.email)}</td>
          <td style="white-space: normal; word-break: break-word;">${student.email || 'N/A'}</td>
          <td>${student.phone || 'N/A'}</td>
          <td><span class="status-${student.status}">${statusText}</span></td>
          <td>
            <button class="save-btn" style="width: 55px; padding: 6px 0; margin-right: 5px; font-size: 0.8rem;" onclick="editStudent('${student._id}')">Edit</button>
            <button class="delete-btn" style="width: 55px; padding: 6px 0; font-size: 0.8rem;" onclick="deleteStudent('${student._id}')">Delete</button>
          </td>
        `;
      });
    }

    // Edit student - load into form
    function editStudent(studentId) {
      const student = allStudents.find(s => s._id === studentId);
      
      if (student) {
        // Populate form with student data
        document.getElementById('studentId').value = student._id;
        document.getElementById('name').value = student.name;
        document.getElementById('age').value = student.age;
        document.getElementById('course').value = student.course;
        document.getElementById('email').value = student.email || '';
        document.getElementById('phone').value = student.phone || '';
        document.getElementById('status').value = student.status || 'enrolled';
        
        // Update form title and button visibility
        document.getElementById('formTitle').textContent = '‚úèÔ∏è Update Student';
        document.getElementById('saveBtn').style.display = 'none';
        document.getElementById('updateBtn').style.display = 'inline-block';
        
        // Scroll to form
        document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        
        alert('‚úÖ Student loaded! You can now update the details.');
      }
    }

    // Helper function to extract gender (since backend doesn't have gender field)
    function getGenderFromEmail(email) {
      return 'N/A'; // Backend doesn't store gender, so we show N/A
    }

    // Global variable to store all students for search
    let allStudents = [];

    // Search student by name
    async function searchStudent() {
      const searchName = document.getElementById('searchName').value.trim().toLowerCase();
      
      if (!searchName) {
        alert('Please enter a name to search!');
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/students`);
        const result = await response.json();
        
        if (result.success) {
          allStudents = result.data;
          
          // Filter students by name
          const filteredStudents = allStudents.filter(student => 
            student.name.toLowerCase().includes(searchName)
          );

          if (filteredStudents.length === 0) {
            alert('No students found with that name!');
            return;
          }

          // Display search results
          displaySearchResults(filteredStudents);
        }
      } catch (error) {
        console.error('Error searching students:', error);
        alert('‚ùå Error searching students. Make sure backend is running!');
      }
    }

    // Display search results in dropdown
    function displaySearchResults(students) {
      const searchResults = document.getElementById('searchResults');
      const studentSelect = document.getElementById('studentSelect');
      
      // Clear previous results
      studentSelect.innerHTML = '';
      
      // Add students to dropdown
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student._id;
        option.textContent = `${student.name} - ${student.course} (Age: ${student.age})`;
        studentSelect.appendChild(option);
      });
      
      // Show results
      searchResults.style.display = 'block';
    }

    // Load selected student into form
    function loadSelectedStudent() {
      const studentSelect = document.getElementById('studentSelect');
      const selectedId = studentSelect.value;
      
      if (!selectedId) {
        alert('Please select a student from the list!');
        return;
      }

      // Find the student
      const student = allStudents.find(s => s._id === selectedId);
      
      if (student) {
        // Populate form with student data
        document.getElementById('studentId').value = student._id;
        document.getElementById('name').value = student.name;
        document.getElementById('age').value = student.age;
        document.getElementById('course').value = student.course;
        document.getElementById('email').value = student.email || '';
        document.getElementById('phone').value = student.phone || '';
        document.getElementById('status').value = student.status || 'enrolled';
        
        // Update form title and button visibility
        document.getElementById('formTitle').textContent = '‚úèÔ∏è Update Student';
        document.getElementById('saveBtn').style.display = 'none';
        document.getElementById('updateBtn').style.display = 'inline-block';
        
        // Close search results
        closeSearch();
        
        // Scroll to form
        document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
        
        alert('‚úÖ Student loaded! You can now update or delete.');
      }
    }

    // Close search results
    function closeSearch() {
      document.getElementById('searchResults').style.display = 'none';
      document.getElementById('searchName').value = '';
    }

    // Save or Add student (determines based on hidden ID field)
    async function saveStudent() {
      const studentId = document.getElementById('studentId').value;
      
      if (studentId) {
        // If ID exists, it means we're updating
        updateStudent();
      } else {
        // Otherwise, add new student
        addStudent();
      }
    }

    // Add new student to backend
    async function addStudent() {
      let name = document.getElementById("name").value.trim();
      let age = document.getElementById("age").value.trim();
      let gender = document.querySelector("input[name='gender']:checked")?.value;
      let course = document.getElementById("course").value;
      let email = document.getElementById("email").value.trim();
      let phone = document.getElementById("phone").value.trim();
      let status = document.getElementById("status").value;

      if (!name || !age || !course || !email) {
        alert("Please fill all required fields (Name, Age, Course, Email)!");
        return;
      }

      // Prepare student data
      const studentData = {
        name: name,
        age: parseInt(age),
        course: course,
        email: email,
        phone: phone,
        status: status
      };

      try {
        const response = await fetch(`${API_BASE_URL}/students/single`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(studentData)
        });

        const result = await response.json();

        if (result.success) {
          alert('‚úÖ Student added successfully!');
          resetForm();
          loadStudents(); // Reload the table
        } else {
          alert('‚ùå Error: ' + result.message);
        }
      } catch (error) {
        console.error('Error adding student:', error);
        alert('‚ùå Error adding student. Make sure backend is running!');
      }
    }

    // Update existing student
    async function updateStudent() {
      const studentId = document.getElementById('studentId').value;
      
      if (!studentId) {
        alert('No student selected for update!');
        return;
      }

      let name = document.getElementById("name").value.trim();
      let age = document.getElementById("age").value.trim();
      let course = document.getElementById("course").value;
      let email = document.getElementById("email").value.trim();
      let phone = document.getElementById("phone").value.trim();
      let status = document.getElementById("status").value;

      if (!name || !age || !course || !email) {
        alert("Please fill all required fields (Name, Age, Course, Email)!");
        return;
      }

      // Prepare update data
      const updateData = {
        name: name,
        age: parseInt(age),
        course: course,
        email: email,
        phone: phone,
        status: status
      };

      try {
        const response = await fetch(`${API_BASE_URL}/students/${studentId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        });

        const result = await response.json();

        if (result.success) {
          alert('‚úÖ Student updated successfully!');
          resetForm();
          loadStudents(); // Reload the table
        } else {
          alert('‚ùå Error: ' + result.message);
        }
      } catch (error) {
        console.error('Error updating student:', error);
        alert('‚ùå Error updating student. Make sure backend is running!');
      }
    }

    // Delete student from backend
    async function deleteStudent(studentId) {
      if (!confirm('Are you sure you want to delete this student?')) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/students/${studentId}`, {
          method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
          alert('‚úÖ Student deleted successfully!');
          loadStudents(); // Reload the table
        } else {
          alert('‚ùå Error: ' + result.message);
        }
      } catch (error) {
        console.error('Error deleting student:', error);
        alert('‚ùå Error deleting student. Make sure backend is running!');
      }
    }

    // Reset form fields
    function resetForm() {
      // Clear all form fields
      document.getElementById("studentId").value = "";
      document.getElementById("name").value = "";
      document.getElementById("age").value = "";
      document.getElementById("email").value = "";
      document.getElementById("phone").value = "";
      document.getElementById("status").value = "enrolled";
      document.querySelectorAll("input[name='gender']").forEach(r => r.checked = false);
      document.getElementById("course").selectedIndex = 0;
      
      // Reset form to "Add" mode
      document.getElementById('formTitle').textContent = '‚ûï Add New Student';
      document.getElementById('saveBtn').style.display = 'inline-block';
      document.getElementById('updateBtn').style.display = 'none';
    }
  </script>

</body>
</html>
